extends layout

include mixins

block content
  .container.content
    if !contest.isStarted() && (!user || !user.admin)
      include partials/countdown.pug
    else
      .page-header
        h3 Battles
      
      form(action='./battles', method='POST')
        .form-row.align-items-center
          input(type='hidden', name='_csrf', value=_csrf)
          .col-auto
            label.sr-only(for='inlineFormInput') Player1
            input#inlineFormInput.form-control.mb-2(type='text', placeholder='ID of Player1', name='player1')
          .col-auto
            label.sr-only(for='inlineFormInput') Player2
            input#inlineFormInput.form-control.mb-2(type='text', placeholder='ID of Player2', name='player2')
          .col-auto
            button.btn.btn-primary.mb-2(type='submit') Start New Battle

      .table-responsive
        table.table
          thead
            tr
              th Player1
              th Player2
              th Result
              th Date
          tbody
            each battle in battles
              tr
                td
                  if battle.players[0].isPreset
                    = battle.players[0].userText()
                  else
                    a(href=`./submissions/${battle.players[0]._id}`)= battle.players[0].userText()
                td
                  if battle.players[1].isPreset
                    = battle.players[1].userText()
                  else
                    a(href=`./submissions/${battle.players[1]._id}`)= battle.players[1].userText()
                td
                  if battle.result === 'pending'
                    | Pending
                  else if battle.result === 'draw'
                    | Draw
                  else if battle.result === 'settled'
                    = battle.getWinner().userText()
                    = ' '
                    | Won
                td
                  a(href=`./battles/${battle._id}`)= battle.timeText()
